(function(a){function d(d,e){function A(){return n.update(),C(),n}function B(){m.css(v,x/r.ratio),j.css(v,-x),z.start=m.offset()[v];var a=w.toLowerCase();k.css(a,s[e.axis]),l.css(a,s[e.axis]),m.css(a,t[e.axis])}function C(){m.bind("mousedown",D),m[0].ontouchstart=function(a){return a.preventDefault(),m.unbind("mousedown"),D(a.touches[0]),!1},l.bind(c,G),e.scroll&&this.addEventListener?(o[0].addEventListener("DOMMouseScroll",E,!1),o[0].addEventListener("mousewheel",E,!1)):e.scroll&&(o[0].onmousewheel=E)}function D(a){z.start=u?a.pageX:a.pageY;var b=parseInt(m.css(v));return y.start=b=="auto"?0:b,h.bind("mousemove",G),h[0].ontouchmove=function(a){h.unbind("mousemove"),G(a.touches[0])},h.bind(c,F),m.bind(c,F),m[0].ontouchend=h[0].ontouchend=function(a){h.unbind(c),m.unbind(c),F(a.touches[0])},!1}function E(b){if(!(q.ratio>=1)){var b=b||window.event,c=b.wheelDelta?b.wheelDelta/120:-b.detail/3;x-=c*e.wheel,x=f(q[e.axis]-p[e.axis],g(0,x)),m.css(v,x/r.ratio),j.css(v,-x),b=a.event.fix(b),b.preventDefault()}}function F(a){return h.unbind("mousemove",G),h.unbind(c,F),m.unbind(c,F),h[0].ontouchmove=m[0].ontouchend=h[0].ontouchend=null,!1}function G(a){return q.ratio>=1||(y.now=f(s[e.axis]-t[e.axis],g(0,y.start+((u?a.pageX:a.pageY)-z.start))),x=y.now*r.ratio,j.css(v,-x),m.css(v,y.now)),!1}var f=Math.min,g=Math.max,h=a(document),i=a('<div class="viewport" />').height(d.innerHeight()),j=a('<div class="overview" />').append(d.children());i.append(j);var k=a('<div class="scrollbar"><div class="track"><div class="thumb"></div></div></div>'),l=k.find(".track"),m=k.find(".thumb"),n=this,o=d.addClass(b).append(k,i),p={},q={},r={},s={},t={},u=e.axis=="x",v=u?"left":"top",w=u?"Width":"Height",x,y={start:0,now:0},z={};return this.update=function(a){p[e.axis]=i[0]["offset"+w],q[e.axis]=j[0]["scroll"+w],q.ratio=p[e.axis]/q[e.axis],k.toggleClass("disable",q.ratio>=1),s[e.axis]=e.size=="auto"?p[e.axis]:e.size,t[e.axis]=f(s[e.axis],g(0,e.sizethumb=="auto"?s[e.axis]*q.ratio:e.sizethumb)),r.ratio=e.sizethumb=="auto"?q[e.axis]/s[e.axis]:(q[e.axis]-p[e.axis])/(s[e.axis]-t[e.axis]),x=a=="relative"&&q.ratio<=1?f(q[e.axis]-p[e.axis],g(0,x)):0,x=a=="bottom"&&q.ratio<=1?q[e.axis]-p[e.axis]:isNaN(parseInt(a))?x:parseInt(a),B()},A()}var b="gscrollbar",c="mouseup";a.fn[b]=function(c,e){return c==="update"?(this.data("tsb").update(e),this):this.each(function(){a(this).data("tsb",new d(a(this),a.extend({},a.fn[b].defaults,c)))})},a.fn[b].defaults={axis:"y",wheel:40,scroll:!0,size:"auto",sizethumb:"auto"}})(jQuery)