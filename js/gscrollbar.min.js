(function(a){function b(b,c){function w(){return j.update(),y(),j}function x(){p.obj.css(r,t/n.ratio),m.obj.css(r,-t),v.start=p.obj.offset()[r];var a=s.toLowerCase();n.obj.css(a,o[c.axis]),o.obj.css(a,o[c.axis]),p.obj.css(a,p[c.axis])}function y(){p.obj.bind("mousedown",z),p.obj[0].ontouchstart=function(a){return a.preventDefault(),p.obj.unbind("mousedown"),z(a.touches[0]),!1},o.obj.bind("mouseup",C),c.scroll&&this.addEventListener?(k[0].addEventListener("DOMMouseScroll",A,!1),k[0].addEventListener("mousewheel",A,!1)):c.scroll&&(k[0].onmousewheel=A)}function z(a){v.start=q?a.pageX:a.pageY;var b=parseInt(p.obj.css(r));return u.start=b=="auto"?0:b,f.bind("mousemove",C),f[0].ontouchmove=function(a){f.unbind("mousemove"),C(a.touches[0])},f.bind("mouseup",B),p.obj.bind("mouseup",B),p.obj[0].ontouchend=f[0].ontouchend=function(a){f.unbind("mouseup"),p.obj.unbind("mouseup"),B(a.touches[0])},!1}function A(b){if(!(m.ratio>=1)){var b=b||window.event,f=b.wheelDelta?b.wheelDelta/120:-b.detail/3;t-=f*c.wheel,t=d(m[c.axis]-l[c.axis],e(0,t)),p.obj.css(r,t/n.ratio),m.obj.css(r,-t),b=a.event.fix(b),b.preventDefault()}}function B(a){return f.unbind("mousemove",C),f.unbind("mouseup",B),p.obj.unbind("mouseup",B),f[0].ontouchmove=p.obj[0].ontouchend=f[0].ontouchend=null,!1}function C(a){return m.ratio>=1||(u.now=d(o[c.axis]-p[c.axis],e(0,u.start+((q?a.pageX:a.pageY)-v.start))),t=u.now*n.ratio,m.obj.css(r,-t),p.obj.css(r,u.now)),!1}var d=Math.min,e=Math.max,f=a(document),g=a('<div class="viewport" />').height(b.innerHeight()),h=a('<div class="overview" />').append(b.children());g.append(h);var i=a('<div class="scrollbar"><div class="track"><div class="thumb"></div></div></div>'),j=this,k=b.addClass("gscrollbar").append(i,g),l={obj:g},m={obj:h},n={obj:i},o={obj:a(".track",i)},p={obj:a(".thumb",i)},q=c.axis=="x",r=q?"left":"top",s=q?"Width":"Height",t,u={start:0,now:0},v={};return console.log(o,p),this.update=function(a){l[c.axis]=l.obj[0]["offset"+s],m[c.axis]=m.obj[0]["scroll"+s],m.ratio=l[c.axis]/m[c.axis],n.obj.toggleClass("disable",m.ratio>=1),o[c.axis]=c.size=="auto"?l[c.axis]:c.size,p[c.axis]=d(o[c.axis],e(0,c.sizethumb=="auto"?o[c.axis]*m.ratio:c.sizethumb)),n.ratio=c.sizethumb=="auto"?m[c.axis]/o[c.axis]:(m[c.axis]-l[c.axis])/(o[c.axis]-p[c.axis]),t=a=="relative"&&m.ratio<=1?d(m[c.axis]-l[c.axis],e(0,t)):0,t=a=="bottom"&&m.ratio<=1?m[c.axis]-l[c.axis]:isNaN(parseInt(a))?t:parseInt(a),x()},w()}a.fn.gscrollbar=function(c,d){return c==="update"?(this.data("tsb").update(d),this):this.each(function(){a(this).data("tsb",new b(a(this),a.extend({},a.fn.gscrollbar.defaults,c)))})},a.fn.gscrollbar.defaults={axis:"y",wheel:40,scroll:!0,size:"auto",sizethumb:"auto"}})(jQuery)