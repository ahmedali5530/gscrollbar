(function(a){function b(b,c){function t(){return g.update(),v(),g}function u(){m.obj.css(o,q/k.ratio),j.obj.css(o,-q),s.start=m.obj.offset()[o];var a=p.toLowerCase();k.obj.css(a,l[c.axis]),l.obj.css(a,l[c.axis]),m.obj.css(a,m[c.axis])}function v(){m.obj.bind("mousedown",w),m.obj[0].ontouchstart=function(a){return a.preventDefault(),m.obj.unbind("mousedown"),w(a.touches[0]),!1},l.obj.bind("mouseup",z),c.scroll&&this.addEventListener?(h[0].addEventListener("DOMMouseScroll",x,!1),h[0].addEventListener("mousewheel",x,!1)):c.scroll&&(h[0].onmousewheel=x)}function w(a){s.start=n?a.pageX:a.pageY;var b=parseInt(m.obj.css(o));return r.start=b=="auto"?0:b,f.bind("mousemove",z),f[0].ontouchmove=function(a){f.unbind("mousemove"),z(a.touches[0])},f.bind("mouseup",y),m.obj.bind("mouseup",y),m.obj[0].ontouchend=f[0].ontouchend=function(a){f.unbind("mouseup"),m.obj.unbind("mouseup"),y(a.touches[0])},!1}function x(b){if(!(j.ratio>=1)){var b=b||window.event,f=b.wheelDelta?b.wheelDelta/120:-b.detail/3;q-=f*c.wheel,q=d(j[c.axis]-i[c.axis],e(0,q)),m.obj.css(o,q/k.ratio),j.obj.css(o,-q),b=a.event.fix(b),b.preventDefault()}}function y(a){return f.unbind("mousemove",z),f.unbind("mouseup",y),m.obj.unbind("mouseup",y),f[0].ontouchmove=m.obj[0].ontouchend=f[0].ontouchend=null,!1}function z(a){return j.ratio>=1||(r.now=d(l[c.axis]-m[c.axis],e(0,r.start+((n?a.pageX:a.pageY)-s.start))),q=r.now*k.ratio,j.obj.css(o,-q),m.obj.css(o,r.now)),!1}var d=Math.min,e=Math.max,f=a(document),g=this,h=b.addClass("gscrollbar").prepend('<div class="scrollbar"><div class="track"><div class="thumb"></div></div></div>'),i={obj:a(b).children(":not(.scrollbar)").wrapAll('<div class="overview" />').end().children(".overview").wrap('<div class="viewport" />').parent().css("height",b.height())},j={obj:i.obj.children(0)},k={obj:a(".scrollbar",b)},l={obj:a(".track",k.obj)},m={obj:a(".thumb",k.obj)},n=c.axis=="x",o=n?"left":"top",p=n?"Width":"Height",q,r={start:0,now:0},s={};return this.update=function(a){i[c.axis]=i.obj[0]["offset"+p],j[c.axis]=j.obj[0]["scroll"+p],j.ratio=i[c.axis]/j[c.axis],k.obj.toggleClass("disable",j.ratio>=1),l[c.axis]=c.size=="auto"?i[c.axis]:c.size,m[c.axis]=d(l[c.axis],e(0,c.sizethumb=="auto"?l[c.axis]*j.ratio:c.sizethumb)),k.ratio=c.sizethumb=="auto"?j[c.axis]/l[c.axis]:(j[c.axis]-i[c.axis])/(l[c.axis]-m[c.axis]),q=a=="relative"&&j.ratio<=1?d(j[c.axis]-i[c.axis],e(0,q)):0,q=a=="bottom"&&j.ratio<=1?j[c.axis]-i[c.axis]:isNaN(parseInt(a))?q:parseInt(a),u()},t()}a.fn.gscrollbar=function(c,d){return c==="update"?(this.data("tsb").update(d),this):this.each(function(){a(this).data("tsb",new b(a(this),a.extend({},a.fn.gscrollbar.defaults,c)))})},a.fn.gscrollbar.defaults={axis:"y",wheel:40,scroll:!0,size:"auto",sizethumb:"auto"}})(jQuery)