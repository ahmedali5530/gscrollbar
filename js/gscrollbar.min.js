(function(a){function f(f,g){function C(){return p.update(),E(),p}function D(){o.css(x,z/t.ratio),k.css(x,-z),B.start=o.offset()[x];var a=y.toLowerCase();m.css(a,u[g.axis]),n.css(a,u[g.axis]),o.css(a,v[g.axis])}function E(){o.bind(d,F),o[0].ontouchstart=function(a){return a.preventDefault(),o.unbind(d),F(a.touches[0]),!1},n.bind(c,I),g.scroll&&this.addEventListener?(q[0].addEventListener("DOMMouseScroll",G,!1),q[0].addEventListener("mousewheel",G,!1)):g.scroll&&(q[0].onmousewheel=G)}function F(a){B.start=w?a.pageX:a.pageY;var b=parseInt(o.css(x));return A.start=b=="auto"?0:b,j.bind(e,I),j[0].ontouchmove=function(a){j.unbind(e),I(a.touches[0])},j.bind(c,H),o.bind(c,H),o[0].ontouchend=j[0].ontouchend=function(a){j.unbind(c),o.unbind(c),H(a.touches[0])},!1}function G(b){if(!(s.ratio>=1)){var b=b||window.event,c=b.wheelDelta?b.wheelDelta/120:-b.detail/3;z-=c*g.wheel,z=h(s[g.axis]-r[g.axis],i(0,z)),o.css(x,z/t.ratio),k.css(x,-z),b=a.event.fix(b),b.preventDefault()}}function H(a){return j.unbind(e,I),j.unbind(c,H),o.unbind(c,H),j[0].ontouchmove=o[0].ontouchend=j[0].ontouchend=null,!1}function I(a){return s.ratio>=1||(A.now=h(u[g.axis]-v[g.axis],i(0,A.start+((w?a.pageX:a.pageY)-B.start))),z=A.now*t.ratio,k.css(x,-z),o.css(x,A.now)),!1}var h=Math.min,i=Math.max,j=a(document),k=a('<div class="overview" />').append(f.children()),l=a('<div class="viewport" />').height(f.innerHeight()).append(k),m=a('<div class="scrollbar"><div class="track"><div class="thumb"></div></div></div>'),n=m.find(".track"),o=m.find(".thumb"),p=this,q=f.addClass(b).append(m,l),r={},s={},t={},u={},v={},w=g.axis=="x",x=w?"left":"top",y=w?"Width":"Height",z,A={start:0,now:0},B={};return this.update=function(a){r[g.axis]=l[0]["offset"+y],s[g.axis]=k[0]["scroll"+y],s.ratio=r[g.axis]/s[g.axis],m.toggleClass("disable",s.ratio>=1),u[g.axis]=g.size=="auto"?r[g.axis]:g.size,v[g.axis]=h(u[g.axis],i(0,g.sizethumb=="auto"?u[g.axis]*s.ratio:g.sizethumb)),t.ratio=g.sizethumb=="auto"?s[g.axis]/u[g.axis]:(s[g.axis]-r[g.axis])/(u[g.axis]-v[g.axis]),z=a=="relative"&&s.ratio<=1?h(s[g.axis]-r[g.axis],i(0,z)):0,z=a=="bottom"&&s.ratio<=1?s[g.axis]-r[g.axis]:isNaN(parseInt(a))?z:parseInt(a),D()},C()}var b="gscrollbar",c="mouseup",d="mousedown",e="mousemove";a.fn[b]=function(c,d){return c==="update"?(this.data(b).update(d),this):this.each(function(){a(this).data(b,new f(a(this),a.extend({},a.fn[b].defaults,c)))})},a.fn[b].defaults={axis:"y",wheel:40,scroll:!0,size:"auto",sizethumb:"auto"}})(jQuery)